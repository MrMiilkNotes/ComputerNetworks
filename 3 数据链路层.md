# 基本概念

## 数据链路层干了什么？

​	数据链路层的最基本的职责是将来自网络层的数据可靠地传输到相邻节点的主机的网络层，虽然实际上的数据链路层没能做到(真正的可靠)这点，但是它做到了“保证网络层收到的数据都是无误的” -- 不保证目标主机能收到所有数据。可以先从一个简单的双主机的通讯模型开始分析。

<img src="3 数据链路层.assets/1569941487949.png" alt="1569941487949" style="zoom: 50%;" />

​	如图所示，一个简单的双主机的通讯模型，路由器只覆盖到网络层。对于链路层来说，物理层做的事是透明的，链路层只需要确保拿到规定的输入，做出规定的输出，因此可以单独把链路层拎出来讨论。对于网络层来说，数据同样是透明的，这是数据链路层的基本机制之一，称为透明传输。

​	数据链路层不是一股脑将数据丢到链路上，而是对来自网络层的数据做好处理，这个处理有点类似为邮件加的包装盒，将上面的图放大：

<img src="3 数据链路层.assets/1569942597199.png" alt="1569942597199" style="zoom:50%;" />

​	我们将这种封装称为帧，它是数据链路层的基本数据传输单位，这个机制称为封装成帧。单纯的封装成帧没什么卵用，它是数据链路层的另一个机制的基础，差错检验。

​	这三个机制总结自上面的双主机通讯，在链路层中，这种通讯使用了点对点信道，但是，数据链路层中使用的信道并不只是这种方式，还有一种是广播的方式，关于数据链路层的机制以及这两种信道，下面会具体描述(描述。。。)。在广播方式下，会碰到另外的问题：编址，协调。

## 链路层的一些定义

#### 链路(link)

​	无源的点到点的物理线路段，中间无其他的交换结点

#### 数据链路(data link)

​	除物理线路外，还须有通信协议来控制数据的传输。把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

- 常用适配器(即网卡)来实现这些协议的硬件和软件
- 适配器包括了数据链路层和物理层这两层的功能

# 三个基本机制

## 封装成帧(framing)

​	<img src="3 数据链路层.assets/1570086264809.png" alt="1570086264809" style="zoom:50%;" />

​	既然比特流是一维的存在，那它的封装就是加头加尾了，通常来说，帧头是SOH(start of heading)，帧尾是EOT(end of trains)。

​	MTU是指最大传送单元，不包括头尾

## 透明传输

​	封装成帧中，会遇到的问题是想要传输的数据包含了SOH, EOT这样的字符：

<img src="3 数据链路层.assets/1570086622080.png" alt="1570086622080" style="zoom:50%;" />

​	这种问题的解决方式就仁者见仁了，但是可以联系到字符串中的格式化字符串问题，转义字符也成为了“标准”的解决方式

<img src="3 数据链路层.assets/1570086849046.png" alt="1570086849046" style="zoom:50%;" />

​	透明传输在这里提到的是对封装成帧的一种修补，但是个人觉得应该是类似最上面的介绍，透明传输是在网络分层设计中每一层都应当提供的机制

## 差错控制

​	差错检验和差错校正是不同的，这也是数据链路层没能完成它的使命的点。实际的数据链路层中提供的机制是差错检验，而且丢弃出错的包，它没能提供差错校正是出自于效率问题，作业一的补充题对此进行了描述，但是并没有实际数据对两种机制进行分析。

>  误码率(BER)：在一段时间内，传输错误的比特占所传输比特总数的比率

​	在实际使用中，差错检验使用的是**循环冗余检验(CRC)**：双方商定一个n+1位的除数P，发送数据的时候将二进制码左移n位并除以P，得到的余数称为帧检验序列(FCS)，将其附着在要发送的数据后面，接收者进行同样的计算来检测数据的正确性。

​	经过CRC的检验，如果数据出现了错误(称为比特差错)，会被直接丢弃。但是在传输过程中，如果出现帧丢失，帧重复，帧失序并不属于差错检验的管辖范围。

# 两种信道类型

## 点对点信道

​	在点对点信道中，最常使用的协议是点对点协议(PPP, point to point protocol)。PPP是用户计算机和ISP通讯时使用的数据链路层协议，互联网用户通常需要连接到某个ISP才能接入到互联网

> ISP: internet service provider

​	<img src="3 数据链路层.assets/1570173276387.png" alt="1570173276387" style="zoom: 33%;" />

### PPP的责任

​	PPP处于数据链路层中，基于之前的讨论，PPP必须满足三个基本机制。PPP设计者在三个基本的机制以外，对PPP的实现提出了更加具体的需求，从需求和后面的描述中可以看到，PPP不是纯粹的数据链路层协议，它其实包含了物理层和网络层的内容：

| 需求           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| 简单           | **首要需求**，TCP/IP协议栈中最复杂的部分在TCP协议。PPP对数据的处理就只有一个CRC |
| 封装成帧       |                                                              |
| 透明性         |                                                              |
| 差错检测       |                                                              |
| 多种网络层协议 | 在同一条物理链路上同时支持多种网络层协议                     |
| 多种类型链路   | 串行，并行，同步，异步，光，电.... 这两点分别面向网络层和物理层，也算是透明性的内容 |
| 检测连接状态   |                                                              |
| 最大传送单元   |                                                              |
| 网络层地址协商 | 使得互相通讯的两个网络层能够通过协商来获得彼此网络层地址     |
| 数据压缩协商   |                                                              |

### PPP的组成

- 一个将 IP 数据报封装到串行链路的方法：就是将来自网络层的数据封装到帧的方法

- 一个链路控制协议 LCP (Link Control Protocol)：面向物理层部分，用于链路的建立，配置和测试

- **一套**网络控制协议 NCP(Network Control Protocol)：面向网络层部分，每个协议对应不同的网络层协议

### PPP的帧格式

​	在具体的PPP中，帧有了面向实际使用的具体格式：

- 首部的F(flag), A(address), C(control)是固定的，协议字段：0x0021表示信息部分为IP数据报，0x8021表示信息部分为网络层的控制数据

> 这部分知识可能已经过期

- 尾部FCS为帧检验序列

<img src="3 数据链路层.assets/1570175476153.png" alt="1570175476153" style="zoom:50%;" />

#### 机制

来自上面提到的透明传输部分

- 字节填充：字节填充使用的转义字符是0x7D
- 零比特填充：这个机制应用在某些特殊情况下。具体地，在发送数据中如果发现有连续5个1，即填入一个0。界定字符可以使用0xF。

### PPP的工作状态



<img src="3 数据链路层.assets/1570176065194.png" alt="1570176065194" style="zoom: 33%;" />

​	这里的物理连接并不是说网线连着，而是发起连接请求(个人电脑的调制解调器呼叫路由器....)。

​	之后会进行LCP协商和(不一定有的)身份验证，NCP配置部分如果是面向IP协议，则会分配IP地址，从而PC可以接入互联网

## 广播信道

